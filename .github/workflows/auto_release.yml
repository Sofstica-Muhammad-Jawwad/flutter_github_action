name: ðŸš€ Auto GitHub Release

on:
  push:
    # Trigger immediately when a push happens to any release branch
    branches:
      - 'release/*.*.*'

jobs:
  create_release:
    runs-on: ubuntu-latest
    
    # Use the PAT_TOKEN for all API interactions in this job
    env:
      GITHUB_TOKEN: ${{ secrets.PAT_TOKEN }}
    
    permissions:
      contents: write
      
    steps:
      - name: Extract Version from Branch Name
        id: extract_version
        run: |
          # The branch ref is e.g., refs/heads/release/0.0.9
          BRANCH_REF="${{ github.ref }}"
          # Extracts just the version number (e.g., 0.0.9)
          VERSION_NUMBER="${BRANCH_REF#refs/heads/release/}"
          
          # Output the version number
          echo "VERSION_NUMBER=$VERSION_NUMBER" >> $GITHUB_OUTPUT

      - name: Create GitHub Release (Draft)
        uses: softprops/action-gh-release@v1
        
        # Token is automatically picked up from the job's 'env' block

        with:
          # The release tag (e.g., v0.0.9)
          tag_name: "v${{ steps.extract_version.outputs.VERSION_NUMBER }}"
          
          # The release name (e.g., v0.0.9)
          name: "v${{ steps.extract_version.outputs.VERSION_NUMBER }}"
          
          # The target commitish is the branch itself
          target_commitish: ${{ github.ref_name }}
          
          # Set as a draft since it's created immediately on push
          draft: true 
          
          # Use a standard body
          body: |
            ### Automated Draft Release
            
            This draft release was created automatically upon pushing to the **`${{ github.ref_name }}`** branch.
            
            It is awaiting the merge of the associated Pull Request into `main` before being published.